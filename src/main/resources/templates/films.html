<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Films - Cinema Booking</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/">ðŸŽ¬ Cinema Booking</a>
        <div class="navbar-nav">
            <a class="nav-link" href="/">Home</a>
            <a class="nav-link active" href="/films">Films</a>
            <a class="nav-link" href="/films/add">Add Film</a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h1>Films</h1>

    <!-- Search and Filter Section -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="input-group">
                <input type="text" id="searchTitle" class="form-control" placeholder="Search by title...">
                <button class="btn btn-outline-secondary" onclick="searchByTitle()">Search</button>
            </div>
        </div>
        <div class="col-md-6">
            <div class="input-group">
                <select id="genreFilter" class="form-select">
                    <option value="">All Genres</option>
                    <option value="ACTION">Action</option>
                    <option value="COMEDY">Comedy</option>
                    <option value="DRAMA">Drama</option>
                    <option value="HORROR">Horror</option>
                    <option value="SCI_FI">Sci-Fi</option>
                    <option value="ROMANCE">Romance</option>
                    <option value="THRILLER">Thriller</option>
                    <option value="ANIMATION">Animation</option>
                    <option value="FANTASY">Fantasy</option>
                </select>
                <button class="btn btn-outline-secondary" onclick="filterByGenre()">Filter</button>
            </div>
        </div>
    </div>

    <!-- Films List -->
    <div id="filmsList" class="row">
        <!-- Films will be loaded here by JavaScript -->
    </div>

    <!-- Loading and Error Messages -->
    <div id="loading" class="text-center">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p>Loading films...</p>
    </div>

    <div id="errorMessage" class="alert alert-danger d-none"></div>
</div>

<script>
    // Load films when page loads
    document.addEventListener('DOMContentLoaded', loadAllFilms);

    function loadAllFilms() {
        showLoading();
        fetch('/api/films')
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.json();
            })
            .then(films => displayFilms(films))
            .catch(error => showError('Error loading films: ' + error.message));
    }

    function searchByTitle() {
        const title = document.getElementById('searchTitle').value;
        if (!title) {
            loadAllFilms();
            return;
        }

        showLoading();
        fetch(`/api/films/search/title?title=${encodeURIComponent(title)}`)
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.json();
            })
            .then(films => displayFilms(films))
            .catch(error => showError('Error searching films: ' + error.message));
    }

    function filterByGenre() {
        const genre = document.getElementById('genreFilter').value;
        if (!genre) {
            loadAllFilms();
            return;
        }

        showLoading();
        fetch(`/api/films/genre/${genre}`)
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.json();
            })
            .then(films => displayFilms(films))
            .catch(error => showError('Error filtering films: ' + error.message));
    }

    function displayFilms(films) {
        hideLoading();
        const filmsList = document.getElementById('filmsList');

        if (films.length === 0) {
            filmsList.innerHTML = '<div class="col-12"><div class="alert alert-info">No films found</div></div>';
            return;
        }

        filmsList.innerHTML = films.map(film => `
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card film-card h-100">
                        <div class="card-body">
                            <h5 class="card-title">${film.title}</h5>
                            <span class="badge bg-primary genre-badge">${film.genre}</span>
                            <p class="card-text mt-2">${film.description || 'No description available'}</p>
                            <div class="film-details">
                                <small class="text-muted">
                                    <strong>Director:</strong> ${film.director || 'Unknown'}<br>
                                    <strong>Duration:</strong> ${film.durationMinutes} min<br>
                                    <strong>Rating:</strong> ${film.ageRating || 'Not rated'}<br>
                                    <strong>Released:</strong> ${film.releaseDate || 'Unknown'}
                                </small>
                            </div>
                        </div>
                        <div class="card-footer">
                            <small class="text-muted">ID: ${film.id}</small>
                        </div>
                    </div>
                </div>
            `).join('');
    }

    function showLoading() {
        document.getElementById('loading').classList.remove('d-none');
        document.getElementById('filmsList').innerHTML = '';
        document.getElementById('errorMessage').classList.add('d-none');
    }

    function hideLoading() {
        document.getElementById('loading').classList.add('d-none');
    }

    function showError(message) {
        hideLoading();
        document.getElementById('errorMessage').textContent = message;
        document.getElementById('errorMessage').classList.remove('d-none');
    }
</script>
</body>
</html>